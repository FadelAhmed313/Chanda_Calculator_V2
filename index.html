<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Chanda Calculator</title>
  <!-- Include Bootstrap CSS -->
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  <style>
    .number-input {
      display: none;
    }
    
    .Inputcontrol {
      width: 100%;
      height: calc(1.5em + .75rem + 2px);
      padding: .375rem .75rem;
      font-size: 1rem;
      font-weight: 400;
      line-height: 1.5;
      color: #495057;
      background-color: #fff;
      background-clip: padding-box;
      border: 1px solid #ced4da;
      border-radius: .25rem;
      transition: border-color .15s ease-in-out, box-shadow .15s ease-in-out;
    }
    
    .footer {
      position: fixed;
      left: 0;
      bottom: 0;
      width: 100%;
      background-color: #343a40;
      color: white;
      text-align: center;
    }
    
    .page-section {
      display: none;
    }
    
    .page-section.active {
      display: block;
    }
    
    .offline-indicator {
      position: fixed;
      top: 10px;
      right: 10px;
      background-color: #ffc107;
      color: #212529;
      padding: 5px 10px;
      border-radius: 4px;
      font-size: 12px;
      z-index: 1000;
      display: none;
    }
    
    .loading-spinner {
      display: none;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      z-index: 1001;
    }
  </style>
</head>

<body>
  <!-- Offline Indicator -->
  <div id="offlineIndicator" class="offline-indicator">
    <span>Offline Mode</span>
  </div>
  
  <!-- Loading Spinner -->
  <div id="loadingSpinner" class="loading-spinner">
    <div class="spinner-border text-warning" role="status">
      <span class="sr-only">Loading...</span>
    </div>
  </div>

  <!-- Navbar -->
  <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <a class="navbar-brand" href="#"><strong>Chanda Calculator</strong></a>
    <button id="navbar" class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNav">
      <ul class="navbar-nav">
        <li class="nav-item">
          <a class="nav-link" href="#home">Home</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#about">About</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#privacy">Privacy and Security</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#rate">%Rate</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#aims">AIMS</a>
        </li>
      </ul>
    </div>
  </nav>

  <!-- Page Content -->
  <div class="container mt-4">
    <!-- Home Page -->
    <div id="home" class="page-section active">
      <form id="salaryForm">
        <div class="form-group">
          <label for="fundType"><strong>Member Type:</strong></label>
          <div class="form-check">
            <input class="form-check-input" type="checkbox" value="Musis" id="musisCheckbox">
            <label class="form-check-label" for="musisCheckbox">
              Are you a Musis?
            </label>
          </div>
        </div>
        
        <label for="fundType"><strong>Member Group:</strong></label>
        <div class="container">
          <div class="row">
            <div class="col">
              <label>
                <input type="radio" name="group" value="Khuddam"> Khuddam
              </label>
            </div>
            <div class="col">
              <label>
                <input type="radio" name="group" value="Lajna"> Lajna
              </label>
            </div>
          </div>
          <div class="row">
            <div class="col">
              <label>
                <input type="radio" name="group" value="Ansar"> Ansar
              </label>
            </div>
            <div class="col">
              <label>
                <input type="radio" name="group" value="Student"> Student
              </label>
            </div>
          </div>
        </div>

        <div class="form-group">
          <label for="salary"><strong>Income:</strong> </label>
          <input type="number" id="salary" class="form-control" min="0" required>
        </div>
        
        <label for="CheckTehrik"><strong>Optional:</strong> </label>
        <div class="row">
          <div class="col">
            <div class="form-check">
              <input class="form-check-input" type="checkbox" id="CheckTehrik">
              <label class="form-check-label" for="CheckTehrik">
                Tehrik-e-Jadid
              </label>
              <div class="form-group">
                <input type="number" id="numberInputTehrik" class="Inputcontrol number-input" min="0">
              </div>
            </div>
          </div>
          <div class="col">
            <div class="form-check">
              <input class="form-check-input" type="checkbox" id="CheckWaqf">
              <label class="form-check-label" for="CheckWaqf">
                Waqf-e-Jadid
              </label>
              <div class="form-group">
                <input type="number" id="numberInputwaqf" class="Inputcontrol number-input" min="0">
              </div>
            </div>
          </div>
        </div>

        <br>
        <button style="width: 100%;" type="button" id="btnCalc" class="btn btn-warning">Calculate</button>
      </form>
      
      <br>
      <div id="table-container"></div>
      <table id="myTable" class="table mt-4">
        <thead>
          <tr>
            <th>Funds</th>
            <th>Amount (Rs)</th>
            <th style="width:30%">+ (Rs)</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td id="aamString">Aam</td>
            <td id="aamValue"></td>
            <td><input type="number" id="inputAam" style="width:50%" min="0"></td>
          </tr>
          <tr>
            <td>Jalsa</td>
            <td id="jalsaValue"></td>
            <td><input type="number" id="inputJalsa" style="width:50%" min="0"></td>
          </tr>
          <tr>
            <td id="groupString">Khuddam</td>
            <td id="khuddamValue"></td>
            <td><input type="number" id="inputKhuddam" style="width:50%" min="0"></td>
          </tr>
          <tr>
            <td>Ijtema</td>
            <td id="ijtemaValue"></td>
            <td><input type="number" id="inputIjtema" style="width:50%" min="0"></td>
          </tr>
          <tr>
            <td style="font-weight: bold;">Total</td>
            <td style="font-weight: bold;" id="totalValue"></td>
            <td style="font-weight: bold;" id="additionalFund">
              <button id="addRowBtn" type="button" class="btn btn-warning">
                <svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" fill="currentColor" class="bi bi-plus-lg" viewBox="0 0 16 16">
                  <path fill-rule="evenodd" d="M8 2a.5.5 0 0 1 .5.5v5h5a.5.5 0 0 1 0 1h-5v5a.5.5 0 0 1-1 0v-5h-5a.5.5 0 0 1 0-1h5v-5A.5.5 0 0 1 8 2"></path>
                </svg>
              </button>
            </td>
          </tr>
        </tbody>
      </table>
      <br /><br /><br />
    </div>

    <!-- About Page -->
    <div id="about" class="page-section">
      <h2>About</h2>
      <div class="col-sm-12 col-md-12 py-4">
        <h4 class="text-white">About</h4>
        <p class="text-muted">The Chanda Calculator is a user-friendly web application designed by MKA Pailles to assist the Ahmadi community members in calculating their Chanda payments accurately. Whether you're a Khuddam, Lajna, or part of the Wassiyat scheme, this tool simplifies the process and ensures transparency.</p>
      </div>
    </div>

    <!-- Privacy Page -->
    <div id="privacy" class="page-section">
      <div class="col-sm-12 col-md-12 py-4">
        <h2>Privacy and Security</h2>
        <h4 class="text-white">Privacy and Security</h4>
        <ul style="list-style-type:square; color:#6c757d;">
          <li><span style="color:#6c757d;">The Chanda Calculator operates entirely on your local web browser. No data is stored or transmitted to external servers.</span></li>
          <li><span style="color:#6c757d;">Your privacy is our priority. Once you close the browser, all entered information is automatically cleared.</span></li>
        </ul>
      </div>
    </div>

    <!-- Rate Page -->
    <div id="rate" class="page-section">
      <h4>% Rate </h4>
      <table class="table table-striped" style="margin-right: calc(1%); width: 99%;">
        <thead class="thead-dark">
          <tr>
            <th scope="col" style="width: 6.2232%;"><span style="font-size: 12px;">#</span></th>
            <th scope="col" style="width: 6.6023%;"><span style="font-size: 12px;">%</span></th>
            <th scope="col" style="width: 15.017%;"><span style="font-size: 12px;">Funds</span></th>
            <th scope="col" style="width: 72.1042%;"><span style="font-size: 12px;">Example</span></th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <th scope="row" style="width: 6.2232%;"><span style="font-size: 12px;">1</span></th>
            <td style="width: 6.6023%;"><span style="font-size: 12px;">10%</span></td>
            <td style="width: 15.017%;"><span style="font-size: 12px;">Chanda Wassiyat Khuddam, Lajna and Ansar</span></td>
            <td style="width: 72.1042%;"><span style="font-size: 12px;">For a monthly salary of Rs10 000, Rs1000 should be paid <span style="color: rgb(226, 80, 65);">monthly</span></span></td>
          </tr>
          <tr>
            <th scope="row" style="width: 6.2232%;"><span style="font-size: 12px;">2</span></th>
            <td style="width: 6.6023%;"><span style="font-size: 12px;">6.25%<br></span></td>
            <td style="width: 15.017%;"><span style="font-size: 12px;">Chanda Aam Khuddam, Lajna and Ansar<br></span></td>
            <td style="width: 72.1042%;"><span style="font-size: 12px;">For a monthly salary of Rs10 000, Rs625 should be paid <span style="color: rgb(226, 80, 65);">monthly</span><br></span></td>
          </tr>
          <tr>
            <th scope="row" style="width: 6.2232%;"><span style="font-size: 12px;">3</span></th>
            <td style="width: 6.6023%;"><span style="font-size: 12px;">10%<br></span></td>
            <td style="width: 15.017%;"><span style="font-size: 12px;">Chanda Jalsa Khuddam, Lajna and Ansar<br></span></td>
            <td style="width: 72.1042%;"><span style="font-size: 12px;">For a monthly salary of Rs10 000, Rs1000 should be paid per <span style="color: rgb(44, 130, 201);">annum&nbsp;</span><strong>or&nbsp;</strong>Rs 83.33 per<strong>&nbsp;</strong><span style="color: rgb(226, 80, 65);">month</span><br></span></td>
          </tr>
          <tr>
            <th scope="row" style="width: 6.2232%;"><span style="font-size: 12px;">4</span></th>
            <td style="width: 6.6023%;"><span style="font-size: 12px;">1%<br></span></td>
            <td style="width: 15.017%;"><span style="font-size: 12px;">Chanda Khuddam, Lajna and Ansar<br></span></td>
            <td style="width: 72.1042%;"><span style="font-size: 12px;">For a monthly salary of Rs10 000, Rs100 should be paid&nbsp;<strong>&nbsp;</strong><span style="color: rgb(226, 80, 65);">monthly</span><br></span></td>
          </tr>
          <tr>
            <th scope="row" style="width: 6.2232%;"><span style="font-size: 12px;">5</span></th>
            <td style="width: 6.6023%;"><span style="font-size: 12px;">3%<br></span></td>
            <td style="width: 15.017%;"><span style="font-size: 12px;">Chanda Ijtema Khuddam and Lajna<br></span></td>
            <td style="width: 72.1042%;"><span style="font-size: 12px;">For a monthly salary of Rs10 000, Rs300 should be paid per <span style="color: rgb(44, 130, 201);">annum&nbsp;</span><strong>or&nbsp;</strong>Rs25 &nbsp;per<strong>&nbsp;</strong><span style="color: rgb(226, 80, 65);">month</span><br></span></td>
          </tr>
          <tr>
            <th scope="row" style="width: 6.2232%;"><span style="font-size: 12px;">6</span></th>
            <td style="width: 6.6023%;"><span style="font-size: 12px;">0.08%<br></span></td>
            <td style="width: 15.017%;"><span style="font-size: 12px;">Chanda Ijtema Ansar<br></span></td>
            <td style="width: 72.1042%;"><span style="font-size: 12px;">For a monthly salary of Rs10 000, Rs108 should be paid per <span style="color: rgb(44, 130, 201);">annum&nbsp;</span><strong>or&nbsp;</strong>Rs9 &nbsp;per<strong>&nbsp;</strong><span style="color: rgb(226, 80, 65);">month</span><br></span></td>
          </tr>
        </tbody>
      </table>
      <blockquote class="blockquote">
        <p><span style="font-size:10px;"><i>Note : Students and non-working members are required to pay a monthly fee of&nbsp;</i></span><span style="background-color:#212121;color:rgb(250,197,28);font-size:10px;"><i>Rs 60 for Chanda Khuddam/Lajna</i></span><span style="font-size:10px;"><i> and </i></span><span style="background-color:#212121;color:rgb(250,197,28);font-size:10px;"><i>Rs 15 for Chanda Ijtama.</i></span></p>
      </blockquote>
      <p><br><br><br></p>
    </div>

    <!-- AIMS Page -->
    <div id="aims" class="page-section">
      <div class="col-sm-12 col-md-12 py-4">
        <h2>AIMS</h2>
        <form id="aimsForm">
          <!-- Text field for number AIMS-->
          <div class="form-group">
            <label for="inputAddress">Aims Number</label>
            <input type="number" class="form-control" id="AIMSnumber" name="number" required>
          </div>
          <h6>From</h6>
          <div class="form-group col-md-6">
            <label for="inputEmail4">Year</label>
            <select class="form-control" id="year"></select>
          </div>
          <div class="form-group col-md-6">
            <label for="inputPassword4">Month</label>
            <select class="form-control" id="month" name="month">
              <option value="January">January</option>
              <option value="February">February</option>
              <option value="March">March</option>
              <option value="April">April</option>
              <option value="May">May</option>
              <option value="June">June</option>
              <option value="July">July</option>
              <option value="August">August</option>
              <option value="September">September</option>
              <option value="October">October</option>
              <option value="November">November</option>
              <option value="December">December</option>
            </select>
          </div>
          <h6>To</h6>
          <div class="form-group col-md-6">
            <label for="inputEmail4">Year</label>
            <select class="form-control" id="toYear"></select>
          </div>
          <div class="form-group col-md-6">
            <label for="inputPassword4">Month</label>
            <select class="form-control" id="toMonth" name="month">
              <option value="January">January</option>
              <option value="February">February</option>
              <option value="March">March</option>
              <option value="April">April</option>
              <option value="May">May</option>
              <option value="June">June</option>
              <option value="July">July</option>
              <option value="August">August</option>
              <option value="September">September</option>
              <option value="October">October</option>
              <option value="November">November</option>
              <option value="December">December</option>
            </select>
          </div>
          <br>
          <button id="save-button" type="submit" style="width:100%;" class="btn btn-warning">Save</button>
        </form>
        <div class="container mt-4">
          <div id="errorMessages" class="mt-3 text-danger"></div>
          <div id="successMessages" class="mt-3 text-success"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- Include Bootstrap JS and jQuery -->
  <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.3/dist/umd/popper.min.js"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

  <script>
    // Register Service Worker for offline functionality
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', function() {
        navigator.serviceWorker.register('/sw.js')
          .then(function(registration) {
            console.log('ServiceWorker registration successful with scope: ', registration.scope);
          })
          .catch(function(error) {
            console.log('ServiceWorker registration failed: ', error);
          });
      });
    }

    // Check online/offline status
    window.addEventListener('online', updateOnlineStatus);
    window.addEventListener('offline', updateOnlineStatus);

    function updateOnlineStatus() {
      const offlineIndicator = document.getElementById('offlineIndicator');
      if (navigator.onLine) {
        offlineIndicator.style.display = 'none';
      } else {
        offlineIndicator.style.display = 'block';
      }
    }

    // Initialize the application
    document.addEventListener("DOMContentLoaded", function() {
      initApp();
      updateOnlineStatus(); // Check initial status
    });

    function initApp() {
      // Initialize page navigation
      initNavigation();
      
      // Initialize form controls
      initFormControls();
      
      // Initialize year dropdowns
      initYearDropdowns();
      
      // Load saved data
      loadSavedData();
      
      // Initialize event listeners
      initEventListeners();
    }

    function initNavigation() {
      const pages = ["home", "about", "privacy", "rate", "aims"];
      const defaultPage = "home";

      function showPage(page) {
        pages.forEach((p) => {
          document.getElementById(p).classList.remove("active");
        });
        document.getElementById(page).classList.add("active");
      }

      // Initial page load
      const initialPage = window.location.hash ? window.location.hash.substr(1) : defaultPage;
      showPage(initialPage);

      // Listen for hash changes
      window.addEventListener("hashchange", function() {
        const currentPage = window.location.hash.substr(1);
        showPage(currentPage);
        document.getElementById("navbar").click();
      });
    }

    function initFormControls() {
      // Initialize optional input visibility
      const checkTehrik = document.getElementById("CheckTehrik");
      const checkWaqf = document.getElementById("CheckWaqf");
      const numberInputTehrik = document.getElementById("numberInputTehrik");
      const numberInputWaqf = document.getElementById("numberInputwaqf");

      checkTehrik.addEventListener("change", () => {
        numberInputTehrik.style.display = checkTehrik.checked ? "block" : "none";
        if (!checkTehrik.checked) numberInputTehrik.value = "";
      });

      checkWaqf.addEventListener("change", () => {
        numberInputWaqf.style.display = checkWaqf.checked ? "block" : "none";
        if (!checkWaqf.checked) numberInputWaqf.value = "";
      });
    }

    function initYearDropdowns() {
      // Initialize year dropdowns
      const currentYear = new Date().getFullYear();
      const yearSelect = document.getElementById("year");
      const toYearSelect = document.getElementById("toYear");

      for (let i = 0; i < 3; i++) {
        const year = currentYear - i;
        yearSelect.add(new Option(year, year));
        toYearSelect.add(new Option(year, year));
      }
    }

    function loadSavedData() {
      // Load saved AIMS data
      const forYear = localStorage.getItem("yearString");
      const forMonth = localStorage.getItem("monthString");
      const fortoYear = localStorage.getItem("toYearString");
      const fortoMonth = localStorage.getItem("toMonthString");
      const getAIMSnumber = localStorage.getItem("AIMSnumber");

      if (forYear && forMonth && fortoYear && fortoMonth && getAIMSnumber) {
        document.getElementById("AIMSnumber").value = getAIMSnumber;
        document.getElementById("year").value = forYear;
        document.getElementById("month").value = forMonth;
        document.getElementById("toYear").value = fortoYear;
        document.getElementById("toMonth").value = fortoMonth;
        
        generateAimsTable({
          'Aims': getAIMSnumber,
          'From': `${forMonth} ${forYear}`,
          'To': `${fortoMonth} ${fortoYear}`
        });
      }
    }

    function initEventListeners() {
      // Calculate button
      document.getElementById("btnCalc").addEventListener("click", calculate);
      
      // Add row button
      document.getElementById("addRowBtn").addEventListener("click", addRow);
      
      // AIMS form submission
      document.getElementById("aimsForm").addEventListener("submit", saveData);
      
      // Input change listeners for real-time calculation
      const inputs = document.querySelectorAll("#salary, #inputAam, #inputJalsa, #inputKhuddam, #inputIjtema, #numberInputTehrik, #numberInputwaqf");
      inputs.forEach(input => {
        input.addEventListener("input", calculate);
      });
    }

    function generateAimsTable(data) {
      const tableContainer = document.getElementById("table-container");
      
      // Remove existing table
      const existingTable = tableContainer.querySelector("table");
      if (existingTable) {
        existingTable.remove();
      }
      
      // Check if 'From' is equal to 'To'
      const displayTo = (data['From'] !== data['To']);
      
      // Create table
      const table = document.createElement('table');
      table.style.cssText = 'width:65%; border:0px;';
      
      // Create header row
      const headerRow = table.insertRow();
      for (const key in data) {
        if (data[key] !== null && !data[key].includes("null")) {
          const headerText = (key === 'From' && !displayTo) ? 'Month' : key;
          const headerCell = document.createElement('th');
          headerCell.textContent = headerText;
          headerCell.style.cssText = 'text-align: center;font-size: smaller;font-weight: bold;';
          headerRow.appendChild(headerCell);
        }
      }
      
      // Create value row
      const valueRow = table.insertRow();
      for (const key in data) {
        if (data[key] !== null && !data[key].includes("null")) {
          const valueCell = valueRow.insertCell();
          valueCell.textContent = data[key];
          valueCell.style.cssText = 'text-align: center;font-size: smaller;';
        }
      }
      
      // Append table to container
      tableContainer.appendChild(table);
    }

    function addRow() {
      const table = document.getElementById("myTable");
      const newRow = table.insertRow(table.rows.length - 1);
      
      // Create cells
      const fundCell = newRow.insertCell();
      const amountCell = newRow.insertCell();
      const inputCell = newRow.insertCell();
      
      // Create input fields
      const fundInput = document.createElement("input");
      fundInput.type = "text";
      fundInput.style.width = "100%";
      fundInput.placeholder = "Fund Name";
      
      const amountInput = document.createElement("input");
      amountInput.type = "number";
      amountInput.style.width = "75%";
      amountInput.min = "0";
      amountInput.className = "additionalField";
      amountInput.addEventListener("input", calculate);
      
      // Append inputs to cells
      fundCell.appendChild(fundInput);
      amountCell.appendChild(amountInput);
      
      // Empty cell for alignment
      inputCell.innerHTML = "&nbsp;";
    }

    function calculate() {
      // Get form values
      const salary = parseFloat(document.getElementById("salary").value) || 0;
      const isMusis = document.getElementById("musisCheckbox").checked;
      const group = document.querySelector('input[name="group"]:checked')?.value;
      const inputTehrik = parseFloat(document.getElementById("numberInputTehrik").value) || 0;
      const inputWaqf = parseFloat(document.getElementById("numberInputwaqf").value) || 0;
      const inputAam = parseFloat(document.getElementById("inputAam").value) || 0;
      const inputJalsa = parseFloat(document.getElementById("inputJalsa").value) || 0;
      const inputKhuddam = parseFloat(document.getElementById("inputKhuddam").value) || 0;
      const inputIjtema = parseFloat(document.getElementById("inputIjtema").value) || 0;
      
      // Get additional field values
      const additionalFields = document.querySelectorAll(".additionalField");
      let totalAdditional = 0;
      additionalFields.forEach(field => {
        totalAdditional += parseFloat(field.value) || 0;
      });
      
      // Validate inputs
      if (!group) {
        alert("Please select a member group!");
        return;
      }
      
      // Calculate based on group and type
      let aamString, groupString, aam, jalsa, khuddam, ijtema;
      
      if (group === "Student") {
        aamString = "Aam";
        groupString = "Non-working";
        aam = 0;
        jalsa = 0;
        khuddam = 60;
        ijtema = 15;
      } else {
        // Set string values
        aamString = isMusis ? "Wassiyat" : "Aam";
        groupString = group;
        
        // Calculate amounts based on group and type
        if (group === "Ansar") {
          aam = isMusis ? 
            Math.ceil((10 / 100) * salary) : 
            Math.ceil((6.25 / 100) * salary);
          
          jalsa = Math.ceil((0.833 / 100) * salary);
          khuddam = Math.ceil((1 / 100) * salary);
          ijtema = Math.ceil((0.0833 / 100) * salary);
        } else {
          aam = isMusis ? 
            Math.ceil((10 / 100) * salary) : 
            Math.ceil((6.25 / 100) * salary);
          
          jalsa = Math.ceil(((10 / 100) * salary) / 12);
          khuddam = Math.ceil((1 / 100) * salary);
          ijtema = Math.ceil(((3 / 100) * salary) / 12);
        }
      }
      
      // Add input adjustments
      aam += inputAam;
      jalsa += inputJalsa;
      khuddam += inputKhuddam;
      ijtema += inputIjtema;
      
      // Calculate total
      let total = aam + jalsa + khuddam + ijtema + inputTehrik + inputWaqf + totalAdditional;
      
      // Update UI
      document.getElementById("aamString").textContent = aamString;
      document.getElementById("aamValue").textContent = aam;
      document.getElementById("jalsaValue").textContent = jalsa;
      document.getElementById("groupString").textContent = groupString;
      document.getElementById("khuddamValue").textContent = khuddam;
      document.getElementById("ijtemaValue").textContent = ijtema;
      document.getElementById("totalValue").textContent = total;
      
      // Update optional funds table
      updateOptionalFunds(inputTehrik, inputWaqf);
    }

    function updateOptionalFunds(tehrik, waqf) {
      const table = document.getElementById("myTable");
      const lastRow = table.rows[table.rows.length - 1];
      
      // Remove existing optional fund rows
      const rows = Array.from(table.rows);
      rows.forEach((row, index) => {
        if (row.cells[0]?.textContent.includes("Tehrik") || 
            row.cells[0]?.textContent.includes("Waqf")) {
          table.deleteRow(index);
        }
      });
      
      // Add optional fund rows if needed
      if (tehrik > 0) {
        const newRow = table.insertRow(table.rows.length - 1);
        const cell1 = newRow.insertCell(0);
        const cell2 = newRow.insertCell(1);
        cell1.textContent = "Tehrik-e-Jadid";
        cell2.textContent = tehrik;
      }
      
      if (waqf > 0) {
        const newRow = table.insertRow(table.rows.length - 1);
        const cell1 = newRow.insertCell(0);
        const cell2 = newRow.insertCell(1);
        cell1.textContent = "Waqf-e-Jadid";
        cell2.textContent = waqf;
      }
    }

    function doMonthsCompare(month1, month2) {
      const months = [
        'January', 'February', 'March', 'April', 'May', 'June',
        'July', 'August', 'September', 'October', 'November', 'December'
      ];
      
      const index1 = months.indexOf(month1);
      const index2 = months.indexOf(month2);
      
      if (index1 === -1 || index2 === -1) {
        return false;
      }
      
      return index1 > index2;
    }

    function saveData(event) {
      event.preventDefault();
      
      const year = document.getElementById("year").value;
      const month = document.getElementById("month").value;
      const toYear = document.getElementById("toYear").value;
      const toMonth = document.getElementById("toMonth").value;
      const AIMSnumber = document.getElementById("AIMSnumber").value;
      
      // Validation
      if (!year || !month || !toYear || !toMonth || !AIMSnumber) {
        alert("Please fill in all fields.");
        return;
      }
      
      if (year > toYear) {
        alert("The 'Year From' field must not exceed the 'Year To' field.");
        return;
      }
      
      if (year === toYear && doMonthsCompare(month, toMonth)) {
        alert("Please ensure that the 'Month From' field is set to a month earlier than the 'Month To' field.");
        return;
      }
      
      // Save data to local storage
      localStorage.setItem("monthString", month);
      localStorage.setItem("yearString", year);
      localStorage.setItem("toYearString", toYear);
      localStorage.setItem("toMonthString", toMonth);
      localStorage.setItem("AIMSnumber", AIMSnumber);
      
      // Update UI
      generateAimsTable({
        'Aims': AIMSnumber,
        'From': `${month} ${year}`,
        'To': `${toMonth} ${toYear}`
      });
      
      alert("Your data has been successfully saved! Now, let's head back to the home page to calculate your chanda.");
    }
  </script>
</body>

<footer class="footer mt-auto py-3 bg-dark">
  <div class="container">
    <p><span style="color: #ffc107;">Contact : <span style="color: #ffffff;"><a style="color: #ffffff;" title="Contact " href="mailto:darussalaamoffice@gmail.com" target="_blank">darussalaamoffice@gmail.com</a></span></span></p>
  </div>
</footer>

</html>
